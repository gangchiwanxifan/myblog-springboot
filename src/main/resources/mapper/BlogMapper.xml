<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="myblog.mapper.BlogMapper">

    <resultMap id="BlogList" type="BlogList">
        <result property="blogId" column="blog_id"/>
        <result property="blogTitle" column="blog_title"/>
        <result property="blogAuthorId" column="blog_author_id"/>
        <result property="nickname" column="nickname"/>
        <result property="blogTags" column="blog_tags"/>
        <result property="blogAvatar" column="blog_avatar"/>
        <result property="blogDescription" column="blog_description"/>
        <result property="favoriteCount" column="favorite_count"/>
        <result property="commentCount" column="comment_count"/>
    </resultMap>

    <select id="getBlogList" resultMap="BlogList">
        SELECT
            blog_id,
            blog_title,
            blog_author_id,
            nickname,
            blog_tags,
            blog_avatar,
            blog_description,
            COUNT(favorite_id) favorite_count,
            COUNT(comment_id) comment_count,
            blog.create_time
        FROM
            blog
            LEFT JOIN `user`
            ON blog_author_id = user_id
            LEFT JOIN favorite
            ON blog_id = favorite_blog_id
            LEFT JOIN `comment`
            ON blog_id = comment_blog_id
        GROUP BY
            blog_id
        ORDER BY
            blog.create_time DESC
    </select>

    <select id="getChannelList" resultMap="BlogList">
        SELECT
            blog_id,
            blog_title,
            blog_author_id,
            nickname,
            blog_tags,
            blog_avatar,
            blog_description,
            COUNT(favorite_id) favorite_count,
            COUNT(comment_id) comment_count,
            blog.create_time
        FROM
            blog
                LEFT JOIN `user`
                          ON blog_author_id = user_id
                LEFT JOIN favorite
                          ON blog_id = favorite_blog_id
                LEFT JOIN `comment`
                          ON blog_id = comment_blog_id
        where blog_channel_id = #{channelId}
        GROUP BY
            blog_id
        ORDER BY
        <if test="sortByViews == false">
            blog.create_time DESC
        </if>
        <if test="sortByViews == true">
            blog_views DESC
        </if>

    </select>

</mapper>
